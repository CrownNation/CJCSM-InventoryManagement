"use strict";(self.webpackChunkInventory_Web=self.webpackChunkInventory_Web||[]).push([[738],{2738:(li,N,s)=>{s.r(N),s.d(N,{TallyModule:()=>ei});var y=s(6814),D=s(5940),_=s(5683),c=s(5313),Q=s(1476),T=s(5195),E=s(617),P=s(2296),v=s(2032),S=s(8525),l=s(6223),$=s(2596),w=s(7700),C=s(3305),b=s(8034),A=s(3680),B=s(1919),e=s(5879);let Y=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[A.BQ]})}return i})();var q=s(1303),Z=s(5387),W=s(5877),O=s(3739),x=s(8645),d=s(9773),j=s(8577),V=s(4031),H=s(8145),M=s(342),X=s(4124),z=s(6232),U=s(4664),J=s(5176),g=s(2036),L=s(8337),F=s(5844),K=s(1591),m=s(4221);const{selectEntities:ee,selectAll:te}=K.Jj.getSelectors(),u=(0,m.ZF)("pipeDefinition"),ie=((0,m.P1)(u,i=>i),(0,m.P1)(u,te)),ne=((0,m.P1)(u,ee),(0,m.P1)(u,i=>i.loadingPipeDefinitions));(0,m.P1)(u,i=>i.errorLoadingPipeDefinitions),(0,m.P1)(u,i=>i.creatingPipeDefinition),(0,m.P1)(u,i=>i.createdPipeDefinition),(0,m.P1)(u,i=>i.errorCreatingPipeDefinition),(0,m.P1)(u,i=>i.selectedPipeDefinition),(0,m.P1)(u,i=>i.errorLoadingSelectedPipeDefinition),(0,m.P1)(u,i=>i.updatingPipeDefinition),(0,m.P1)(u,i=>i.updatedPipeDefinition),(0,m.P1)(u,i=>i.errorUpdatingPipeDefinition);var R=s(2939),oe=s(8069),I=s(4630);const re=["errorLabel"],ae=["categoryInput"],le=["coatingInput"],se=["conditionInput"],ce=["gradeInput"],me=["rangeInput"],pe=["threadInput"],de=["sizeInput"],ue=["wallInput"],fe=["weightInput"];function ge(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function he(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function _e(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Ce(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function ye(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function be(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Te(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE(" ",t.sizeMetric,"(mm)\xa0\xa0/\xa0",t.sizeImperial,"(in) ")}}function Pe(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE(" ",t.wallMetric," (mm)\xa0\xa0/\xa0",t.wallImperial," (in) ")}}function Ae(i,r){if(1&i&&(e.TgZ(0,"mat-option",62),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE(" ",t.weightInKgPerMeter," (kg/m)\xa0\xa0/\xa0",t.weightInLbsPerFoot," (Lbs/ft) ")}}function ve(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Category"),e.qZA())}function we(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.category?null:t.category.name,"")}}function Ze(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Coating"),e.qZA())}function Ie(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.coating?null:t.coating.name,"")}}function De(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Condition"),e.qZA())}function Se(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.condition?null:t.condition.name,"")}}function qe(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Grade"),e.qZA())}function xe(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.grade?null:t.grade.name,"")}}function Me(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Range"),e.qZA())}function Fe(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.range?null:t.range.name,"")}}function ke(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Thread"),e.qZA())}function Ne(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.thread?null:t.thread.name,"")}}function Ee(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Size (mm))"),e.qZA())}function Oe(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.size?null:t.size.sizeMetric,"")}}function ze(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Size (in)"),e.qZA())}function Ue(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.size?null:t.size.sizeImperial,"")}}function Je(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Wall (mm)"),e.qZA())}function Le(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.wall?null:t.wall.wallMetric,"")}}function Re(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Wall (in)"),e.qZA())}function Qe(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.wall?null:t.wall.wallImperial,"")}}function $e(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Weight (kg/m)"),e.qZA())}function Be(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.weight?null:t.weight.weightInKgPerMeter,"")}}function Ge(i,r){1&i&&(e.TgZ(0,"th",63),e._uU(1,"Weight (Lbs/ft)"),e.qZA())}function Ye(i,r){if(1&i&&(e.TgZ(0,"td",64),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",null==t.weight?null:t.weight.weightInLbsPerFoot,"")}}function We(i,r){1&i&&e._UZ(0,"tr",65)}function je(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"tr",66),e.NdJ("click",function(){const a=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.selection.toggle(a))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw();e.ekj("selected",o.selection.isSelected(t))}}function Ve(i,r){1&i&&(e.TgZ(0,"div",67),e._UZ(1,"mat-progress-spinner",68),e.qZA())}let He=(()=>{class i{constructor(t,o,n,a){this.store=t,this.dialogRef=o,this.snackBar=n,this.pipeDefinitionService=a,this.displayedColumns=["Category","Coating","Condition","Grade","Range","Thread","Size Metric","Size Imperial","Wall Metric","Wall Imperial","Weight Metric","Weight Imperial"],this.categoryControl=new l.NI,this.coatingControl=new l.NI,this.conditionControl=new l.NI,this.gradeControl=new l.NI,this.rangeControl=new l.NI,this.threadControl=new l.NI,this.sizeControl=new l.NI,this.wallControl=new l.NI,this.weightControl=new l.NI,this.unsubscribe$=new x.x,this.dataSource=new c.by([]),this.pipeDefinitionsList$=this.store.select(ie),this.loadingPipeDefinitions=!1,this.loading$=this.store.select(ne),this.pipeDefinitionSearchParams={categoryId:null,coatingId:null,conditionId:null,gradeId:null,rangeId:null,sizeId:null,threadId:null,wallId:null,weightId:null,isActive:!0},this.selection=new L.Ov(!1,[]),this.categories=[],this.coatings=[],this.conditions=[],this.grades=[],this.ranges=[],this.sizes=[],this.threads=[],this.walls=[],this.weights=[],this.filteredCategories=[],this.filteredCoatings=[],this.filteredConditions=[],this.filteredGrades=[],this.filteredRanges=[],this.filteredThreads=[],this.filteredSizes=[],this.filteredWalls=[],this.filteredWeights=[],this.categories$=this.store.select(g.us),this.coatings$=this.store.select(g.h3),this.conditions$=this.store.select(g.QG),this.grades$=this.store.select(g.x8),this.ranges$=this.store.select(g.Sl),this.threads$=this.store.select(g.se),this.sizes$=this.store.select(g.Ry),this.walls$=this.store.select(g.N$),this.weights$=this.store.select(g.Ql),this.pipeForm=new l.cw({category:this.categoryControl,condition:this.conditionControl,coating:this.coatingControl,grade:this.gradeControl,range:this.rangeControl,thread:this.threadControl,size:this.sizeControl,wall:this.wallControl,weight:this.weightControl})}ngOnInit(){this.loading$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.loadingPipeDefinitions=t}),this.store.dispatch((0,J.Nh)()),this.loadPipeDefinitions(),this.subscribeToPipeDefinitions(),this.setupFilterSubscriptions()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}subscribeToPipeDefinitions(){this.pipeDefinitionsList$.subscribe(t=>{t&&(this.dataSource.data=t)})}loadPipeDefinitions(){console.log("Loading pipe definitions."),this.store.dispatch((0,F.gR)({searchParams:this.pipeDefinitionSearchParams}))}setupFilterSubscriptions(){this.categories$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.categories=t,this.filteredCategories=t}),this.coatings$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.coatings=t,this.filteredCoatings=t}),this.conditions$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.conditions=t,this.filteredConditions=t}),this.grades$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.grades=t,this.filteredGrades=t}),this.ranges$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.ranges=t,this.filteredRanges=t}),this.sizes$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.sizes=t,this.filteredSizes=t}),this.threads$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.threads=t,this.filteredThreads=t}),this.walls$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.walls=t,this.filteredWalls=t}),this.weights$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.weights=t,this.filteredWeights=t})}filter(){this.setSearchParametersFromForm(),console.log("Current searchParams:",this.pipeDefinitionSearchParams),this.store.dispatch((0,F.gR)({searchParams:this.pipeDefinitionSearchParams}))}setSearchParametersFromForm(){this.pipeDefinitionSearchParams={categoryId:this.pipeForm.value.category?this.pipeForm.value.category.pipeProperty_CategoryId:null,coatingId:this.pipeForm.value.coating?this.pipeForm.value.coating.pipeProperty_CoatingId:null,conditionId:this.pipeForm.value.condition?this.pipeForm.value.condition.pipeProperty_ConditionId:null,gradeId:this.pipeForm.value.grade?this.pipeForm.value.grade.pipeProperty_GradeId:null,rangeId:this.pipeForm.value.range?this.pipeForm.value.range.pipeProperty_RangeId:null,threadId:this.pipeForm.value.thread?this.pipeForm.value.thread.pipeProperty_ThreadId:null,sizeId:this.pipeForm.value.size?this.pipeForm.value.size.pipeProperty_SizeId:null,wallId:this.pipeForm.value.wall?this.pipeForm.value.wall.pipeProperty_WallId:null,weightId:this.pipeForm.value.weight?this.pipeForm.value.weight.pipeProperty_WeightId:null,isActive:!0}}clearForm(){this.pipeForm.reset(),this.pipeDefinitionSearchParams={categoryId:null,coatingId:null,conditionId:null,gradeId:null,rangeId:null,threadId:null,sizeId:null,wallId:null,weightId:null,isActive:!0},this.filteredCategories=[],this.filteredCoatings=[],this.filteredConditions=[],this.filteredGrades=[],this.filteredRanges=[],this.filteredSizes=[],this.filteredThreads=[],this.filteredWalls=[],this.filteredWeights=[],this.store.dispatch((0,F.gR)({searchParams:this.pipeDefinitionSearchParams}))}selectPipeDefinition(){if(this.selection.isEmpty())return void this.showSnackBar("Please select a pipe definition to continue.");const t=this.selection.selected[0];console.log("Selected pipe definition:",t.category?.name),this.dialogRef.close(t)}cancel(){this.dialogRef.close()}newFromFilters(){Object.values(this.pipeForm.value).some(o=>null===o)?this.showSnackBar("All filters must be set before creating a new pipe definition.","Close",{panelClass:["error-snack-bar"]}):this.dataSource.data.some(o=>o.categoryId===this.pipeDefinitionSearchParams.categoryId&&o.coatingId===this.pipeDefinitionSearchParams.coatingId&&o.conditionId===this.pipeDefinitionSearchParams.conditionId&&o.gradeId===this.pipeDefinitionSearchParams.gradeId&&o.rangeId===this.pipeDefinitionSearchParams.rangeId&&o.sizeId===this.pipeDefinitionSearchParams.sizeId&&o.threadId===this.pipeDefinitionSearchParams.threadId&&o.wallId===this.pipeDefinitionSearchParams.wallId&&o.weightId===this.pipeDefinitionSearchParams.weightId)?this.showSnackBar("A pipe definition with these pipe properties already exists.","Close",{panelClass:["error-snack-bar"]}):(this.setSearchParametersFromForm(),console.log("Current search parameters:",JSON.stringify(this.pipeDefinitionSearchParams,null,2)),this.pipeDefinitionService.checkPipeDefinitionExists(this.pipeDefinitionSearchParams).pipe((0,U.w)(o=>(console.log("Received 'exists' value:",o),!1===o?this.createPipeDefinition(this.pipeDefinitionSearchParams):(this.showSnackBar("A pipe definition with these filters already exists on the server.","Close",{panelClass:["error-snack-bar"]}),z.E)))).subscribe({next:o=>{console.log("Pipe definition created successfully:",o),this.showSnackBar("New pipe definition created successfully!","Close",{panelClass:["confirmation-snack-bar"]}),this.loadPipeDefinitions()},error:o=>{this.showSnackBar("Failed to create pipe definition.","Close",{panelClass:["error-snack-bar"]}),console.error("Failed to create pipe definition:",o)}}))}createPipeDefinition(t){return this.pipeDefinitionService.createPipeDefinition({categoryId:t.categoryId,coatingId:t.coatingId,conditionId:t.conditionId,gradeId:t.gradeId,rangeId:t.rangeId,sizeId:t.sizeId,threadId:t.threadId,wallId:t.wallId,weightId:t.weightId,isActive:!0})}showError(t){const o=this.errorLabel.nativeElement;o.textContent=t,o.style.display="block",setTimeout(()=>{o.style.display="none"},5e3)}showSnackBar(t,o="Close",n={duration:5e3,panelClass:["snack-bar"]}){this.snackBar.open(t,o,n)}filterCategories(){const t=this.categoryInput.nativeElement.value.toLowerCase();this.filteredCategories=this.categories.filter(o=>o.name.toLowerCase().includes(t))}filterCoatings(){const t=this.coatingInput.nativeElement.value.toLowerCase();this.filteredCoatings=this.coatings.filter(o=>o.name.toLowerCase().includes(t))}filterConditions(){const t=this.conditionInput.nativeElement.value.toLowerCase();this.filteredConditions=this.conditions.filter(o=>o.name.toLowerCase().includes(t))}filterGrades(){const t=this.gradeInput.nativeElement.value.toLowerCase();this.filteredGrades=this.grades.filter(o=>o.name.toLowerCase().includes(t))}filterRanges(){const t=this.rangeInput.nativeElement.value.toLowerCase();this.filteredRanges=this.ranges.filter(o=>o.name.toLowerCase().includes(t))}filterThreads(){const t=this.threadInput.nativeElement.value.toLowerCase();this.filteredThreads=this.threads.filter(o=>o.name.toLowerCase().includes(t))}filterSizes(){const t=this.sizeInput.nativeElement.value.toLowerCase();this.filteredSizes=this.sizes.filter(o=>(o.sizeMetric.toString().toLowerCase()+"(mm)/"+o.sizeImperial.toString().toLowerCase()+"(in)").includes(t))}filterWalls(){const t=this.wallInput.nativeElement.value.toLowerCase();this.filteredWalls=this.walls.filter(o=>(o.wallMetric.toString().toLowerCase()+"(mm)/"+o.wallImperial.toString().toLowerCase()+"(in)").includes(t))}filterWeights(){const t=this.weightInput.nativeElement.value.toLowerCase();this.filteredWeights=this.weights.filter(o=>(o.weightInKgPerMeter.toString().toLowerCase()+"(kg/m)/"+o.weightInLbsPerFoot.toString().toLowerCase()+"(lbs/ft)").includes(t))}onCoatingBlur(){const t=this.coatingInput.nativeElement.value;this.filteredCoatings.some(o=>o.name.toLowerCase()===t.toLowerCase())||this.coatingControl.setValue("")}onConditionBlur(){const t=this.conditionInput.nativeElement.value;this.filteredConditions.some(o=>o.name.toLowerCase()===t.toLowerCase())||this.conditionControl.setValue("")}onCategoryBlur(){const t=this.categoryInput.nativeElement.value;this.filteredCategories.some(o=>o.name.toLowerCase()===t.toLowerCase())||this.categoryControl.setValue("")}onGradeBlur(){const t=this.gradeInput.nativeElement.value;this.filteredGrades.some(o=>o.name.toLowerCase()===t.toLowerCase())||this.gradeControl.setValue("")}onRangeBlur(){const t=this.rangeInput.nativeElement.value;this.filteredRanges.some(o=>o.name.toLowerCase()===t.toLowerCase())||this.rangeControl.setValue("")}onThreadBlur(){const t=this.threadInput.nativeElement.value;this.filteredThreads.some(o=>o.name.toLowerCase()===t.toLowerCase())||this.threadControl.setValue("")}onSizeBlur(){const t=this.sizeInput.nativeElement.value;this.filteredSizes.find(n=>`${n.sizeMetric}(mm)/${n.sizeImperial}(in)`==t)||this.sizeControl.setValue("")}onWallBlur(){const t=this.wallInput.nativeElement.value;this.filteredWalls.find(n=>`${n.wallMetric}(mm)/${n.wallImperial}(in)`===t)||this.wallControl.setValue("")}onWeightBlur(){const t=this.weightInput.nativeElement.value;this.filteredWeights.find(n=>`${n.weightInKgPerMeter}(kg/m)/${n.weightInLbsPerFoot}(lbs/ft)`===t)||this.weightControl.setValue("")}displayCategory(t){return t?t.name:""}displayCoating(t){return t?t.name:""}displayCondition(t){return t?t.name:""}displayGrade(t){return t?t.name:""}displayRange(t){return t?t.name:""}displayThread(t){return t?t.name:""}displaySize(t){return t?t.sizeMetric+"(mm)/"+t.sizeImperial+"(in)":""}displayWall(t){return t?t.wallMetric+"(mm)/"+t.wallImperial+"(in)":""}displayWeight(t){return t?t.weightInKgPerMeter+"(kg/m)/"+t.weightInLbsPerFoot+"(lbs/ft)":""}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(m.yh),e.Y36(w.so),e.Y36(R.ux),e.Y36(oe.M))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-pipe-definition-select"]],viewQuery:function(o,n){if(1&o&&(e.Gf(re,5),e.Gf(ae,5),e.Gf(le,5),e.Gf(se,5),e.Gf(ce,5),e.Gf(me,5),e.Gf(pe,5),e.Gf(de,5),e.Gf(ue,5),e.Gf(fe,5)),2&o){let a;e.iGM(a=e.CRH())&&(n.errorLabel=a.first),e.iGM(a=e.CRH())&&(n.categoryInput=a.first),e.iGM(a=e.CRH())&&(n.coatingInput=a.first),e.iGM(a=e.CRH())&&(n.conditionInput=a.first),e.iGM(a=e.CRH())&&(n.gradeInput=a.first),e.iGM(a=e.CRH())&&(n.rangeInput=a.first),e.iGM(a=e.CRH())&&(n.threadInput=a.first),e.iGM(a=e.CRH())&&(n.sizeInput=a.first),e.iGM(a=e.CRH())&&(n.wallInput=a.first),e.iGM(a=e.CRH())&&(n.weightInput=a.first)}},decls:134,vars:41,consts:[[2,"margin","0"],[2,"margin-bottom",".5rem","text-align","center"],["expanded","true",1,"filter-options",2,"padding-top","1rem"],[3,"formGroup"],[1,"container-filter"],["appearance","outline","floatLabel","always"],["type","text","placeholder","Select category","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["categoryInput",""],["autoActiveFirstOption","",3,"displayWith"],["autoCategory","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Select coating","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["coatingInput",""],["autoCoating","matAutocomplete"],["type","text","placeholder","Select condition","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["conditionInput",""],["autoCondition","matAutocomplete"],["type","text","placeholder","Select grade","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["gradeInput",""],["autoGrade","matAutocomplete"],["type","text","placeholder","Select range","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["rangeInput",""],["autoRange","matAutocomplete"],["type","text","placeholder","Select thread","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["threadInput",""],["autoThread","matAutocomplete"],["type","text","placeholder","Select size","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["sizeInput",""],["autoSize","matAutocomplete"],["type","text","placeholder","Select wall","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["wallInput",""],["autoWall","matAutocomplete"],["type","text","placeholder","Select weight","matInput","",3,"formControl","matAutocomplete","input","focus","blur"],["weightInput",""],["autoWeight","matAutocomplete"],[1,"item-buttons"],["mat-raised-button","","type","button","color","primary",3,"click"],["mat-raised-button","","type","button",3,"click"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","Category"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","Coating"],["matColumnDef","Condition"],["matColumnDef","Grade"],["matColumnDef","Range"],["matColumnDef","Thread"],["matColumnDef","Size Metric"],["matColumnDef","Size Imperial"],["matColumnDef","Wall Metric"],["matColumnDef","Wall Imperial"],["matColumnDef","Weight Metric"],["matColumnDef","Weight Imperial"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["class","spinner",4,"ngIf"],[1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"errorLabel",2,"display","none","text-align","center","margin-top","5px"],["errorLabel",""],[3,"value"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-row",""],["mat-row","",3,"click"],[1,"spinner"],["color","primary","mode","indeterminate"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Select Pipe Definition"),e.qZA(),e.TgZ(3,"div")(4,"mat-accordion")(5,"mat-expansion-panel",2)(6,"form",3)(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),e._uU(10,"Category"),e.qZA(),e.TgZ(11,"input",6,7),e.NdJ("input",function(){return n.filterCategories()})("focus",function(){return n.filterCategories()})("blur",function(){return n.onCategoryBlur()}),e.qZA(),e.TgZ(13,"mat-autocomplete",8,9),e.YNc(15,ge,2,2,"mat-option",10),e.qZA()(),e.TgZ(16,"mat-form-field",5)(17,"mat-label"),e._uU(18,"Coating"),e.qZA(),e.TgZ(19,"input",11,12),e.NdJ("input",function(){return n.filterCoatings()})("focus",function(){return n.filterCoatings()})("blur",function(){return n.onCoatingBlur()}),e.qZA(),e.TgZ(21,"mat-autocomplete",8,13),e.YNc(23,he,2,2,"mat-option",10),e.qZA()(),e.TgZ(24,"mat-form-field",5)(25,"mat-label"),e._uU(26,"Condition"),e.qZA(),e.TgZ(27,"input",14,15),e.NdJ("input",function(){return n.filterConditions()})("focus",function(){return n.filterConditions()})("blur",function(){return n.onConditionBlur()}),e.qZA(),e.TgZ(29,"mat-autocomplete",8,16),e.YNc(31,_e,2,2,"mat-option",10),e.qZA()(),e.TgZ(32,"mat-form-field",5)(33,"mat-label"),e._uU(34,"Grade"),e.qZA(),e.TgZ(35,"input",17,18),e.NdJ("input",function(){return n.filterGrades()})("focus",function(){return n.filterGrades()})("blur",function(){return n.onGradeBlur()}),e.qZA(),e.TgZ(37,"mat-autocomplete",8,19),e.YNc(39,Ce,2,2,"mat-option",10),e.qZA()(),e.TgZ(40,"mat-form-field",5)(41,"mat-label"),e._uU(42,"Range"),e.qZA(),e.TgZ(43,"input",20,21),e.NdJ("input",function(){return n.filterRanges()})("focus",function(){return n.filterRanges()})("blur",function(){return n.onRangeBlur()}),e.qZA(),e.TgZ(45,"mat-autocomplete",8,22),e.YNc(47,ye,2,2,"mat-option",10),e.qZA()(),e.TgZ(48,"mat-form-field",5)(49,"mat-label"),e._uU(50,"Thread"),e.qZA(),e.TgZ(51,"input",23,24),e.NdJ("input",function(){return n.filterThreads()})("focus",function(){return n.filterThreads()})("blur",function(){return n.onThreadBlur()}),e.qZA(),e.TgZ(53,"mat-autocomplete",8,25),e.YNc(55,be,2,2,"mat-option",10),e.qZA()(),e.TgZ(56,"mat-form-field",5)(57,"mat-label"),e._uU(58,"Size"),e.qZA(),e.TgZ(59,"input",26,27),e.NdJ("input",function(){return n.filterSizes()})("focus",function(){return n.filterSizes()})("blur",function(){return n.onSizeBlur()}),e.qZA(),e.TgZ(61,"mat-autocomplete",8,28),e.YNc(63,Te,2,3,"mat-option",10),e.qZA()(),e.TgZ(64,"mat-form-field",5)(65,"mat-label"),e._uU(66,"Wall"),e.qZA(),e.TgZ(67,"input",29,30),e.NdJ("input",function(){return n.filterWalls()})("focus",function(){return n.filterWalls()})("blur",function(){return n.onWallBlur()}),e.qZA(),e.TgZ(69,"mat-autocomplete",8,31),e.YNc(71,Pe,2,3,"mat-option",10),e.qZA()(),e.TgZ(72,"mat-form-field",5)(73,"mat-label"),e._uU(74,"Weight"),e.qZA(),e.TgZ(75,"input",32,33),e.NdJ("input",function(){return n.filterWeights()})("focus",function(){return n.filterWeights()})("blur",function(){return n.onWeightBlur()}),e.qZA(),e.TgZ(77,"mat-autocomplete",8,34),e.YNc(79,Ae,2,3,"mat-option",10),e.qZA()()(),e.TgZ(80,"div",35)(81,"button",36),e.NdJ("click",function(){return n.filter()}),e._uU(82,"Filter"),e.qZA(),e.TgZ(83,"button",37),e.NdJ("click",function(){return n.clearForm()}),e._uU(84,"Clear filters"),e.qZA()()()()(),e.TgZ(85,"table",38),e.ynx(86,39),e.YNc(87,ve,2,0,"th",40),e.YNc(88,we,2,1,"td",41),e.BQk(),e.ynx(89,42),e.YNc(90,Ze,2,0,"th",40),e.YNc(91,Ie,2,1,"td",41),e.BQk(),e.ynx(92,43),e.YNc(93,De,2,0,"th",40),e.YNc(94,Se,2,1,"td",41),e.BQk(),e.ynx(95,44),e.YNc(96,qe,2,0,"th",40),e.YNc(97,xe,2,1,"td",41),e.BQk(),e.ynx(98,45),e.YNc(99,Me,2,0,"th",40),e.YNc(100,Fe,2,1,"td",41),e.BQk(),e.ynx(101,46),e.YNc(102,ke,2,0,"th",40),e.YNc(103,Ne,2,1,"td",41),e.BQk(),e.ynx(104,47),e.YNc(105,Ee,2,0,"th",40),e.YNc(106,Oe,2,1,"td",41),e.BQk(),e.ynx(107,48),e.YNc(108,ze,2,0,"th",40),e.YNc(109,Ue,2,1,"td",41),e.BQk(),e.ynx(110,49),e.YNc(111,Je,2,0,"th",40),e.YNc(112,Le,2,1,"td",41),e.BQk(),e.ynx(113,50),e.YNc(114,Re,2,0,"th",40),e.YNc(115,Qe,2,1,"td",41),e.BQk(),e.ynx(116,51),e.YNc(117,$e,2,0,"th",40),e.YNc(118,Be,2,1,"td",41),e.BQk(),e.ynx(119,52),e.YNc(120,Ge,2,0,"th",40),e.YNc(121,Ye,2,1,"td",41),e.BQk(),e.YNc(122,We,1,0,"tr",53),e.YNc(123,je,1,2,"tr",54),e.qZA(),e.YNc(124,Ve,2,0,"div",55),e.TgZ(125,"div",56)(126,"button",57),e.NdJ("click",function(){return n.selectPipeDefinition()}),e._uU(127,"Select Pipe Definition"),e.qZA(),e.TgZ(128,"button",58),e.NdJ("click",function(){return n.cancel()}),e._uU(129,"Cancel"),e.qZA(),e.TgZ(130,"button",59),e.NdJ("click",function(){return n.newFromFilters()}),e._uU(131,"New From Filters"),e.qZA()(),e._UZ(132,"div",60,61),e.qZA()()),2&o){const a=e.MAs(14),p=e.MAs(22),h=e.MAs(30),ti=e.MAs(38),ii=e.MAs(46),ni=e.MAs(54),oi=e.MAs(62),ri=e.MAs(70),ai=e.MAs(78);e.xp6(6),e.Q6J("formGroup",n.pipeForm),e.xp6(5),e.Q6J("formControl",n.categoryControl)("matAutocomplete",a),e.xp6(2),e.Q6J("displayWith",n.displayCategory),e.xp6(2),e.Q6J("ngForOf",n.filteredCategories),e.xp6(4),e.Q6J("formControl",n.coatingControl)("matAutocomplete",p),e.xp6(2),e.Q6J("displayWith",n.displayCoating),e.xp6(2),e.Q6J("ngForOf",n.filteredCoatings),e.xp6(4),e.Q6J("formControl",n.conditionControl)("matAutocomplete",h),e.xp6(2),e.Q6J("displayWith",n.displayCondition),e.xp6(2),e.Q6J("ngForOf",n.filteredConditions),e.xp6(4),e.Q6J("formControl",n.gradeControl)("matAutocomplete",ti),e.xp6(2),e.Q6J("displayWith",n.displayGrade),e.xp6(2),e.Q6J("ngForOf",n.filteredGrades),e.xp6(4),e.Q6J("formControl",n.rangeControl)("matAutocomplete",ii),e.xp6(2),e.Q6J("displayWith",n.displayRange),e.xp6(2),e.Q6J("ngForOf",n.filteredRanges),e.xp6(4),e.Q6J("formControl",n.threadControl)("matAutocomplete",ni),e.xp6(2),e.Q6J("displayWith",n.displayThread),e.xp6(2),e.Q6J("ngForOf",n.filteredThreads),e.xp6(4),e.Q6J("formControl",n.sizeControl)("matAutocomplete",oi),e.xp6(2),e.Q6J("displayWith",n.displaySize),e.xp6(2),e.Q6J("ngForOf",n.filteredSizes),e.xp6(4),e.Q6J("formControl",n.wallControl)("matAutocomplete",ri),e.xp6(2),e.Q6J("displayWith",n.displayWall),e.xp6(2),e.Q6J("ngForOf",n.filteredWalls),e.xp6(4),e.Q6J("formControl",n.weightControl)("matAutocomplete",ai),e.xp6(2),e.Q6J("displayWith",n.displayWeight),e.xp6(2),e.Q6J("ngForOf",n.filteredWeights),e.xp6(6),e.Q6J("dataSource",n.dataSource),e.xp6(37),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("ngIf",n.loadingPipeDefinitions)}},dependencies:[y.sg,y.O5,D.Ou,_.KE,_.hX,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,P.lW,v.Nt,A.ey,C.pp,C.ib,l._Y,l.Fj,l.JJ,l.JL,l.oH,l.sg,I.XC,I.ZL],styles:["mat-card[_ngcontent-%COMP%]{min-width:500px;width:100%;overflow-x:auto}h4[_ngcontent-%COMP%]{margin-top:20;margin-bottom:.4rem}.title-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;font-weight:700;font-size:1.5rem}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:1rem;border:solid pink 3px}.container-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;width:100%}.data-column-left[_ngcontent-%COMP%], .data-column-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.data-column-right[_ngcontent-%COMP%]{padding:1px;margin:0;align-items:flex-end}tr.detail-row[_ngcontent-%COMP%]{height:0}tr.element-row[_ngcontent-%COMP%]:not(.expanded-row):hover{background-color:#f5f5f5}tr.element-row[_ngcontent-%COMP%]:not(.expanded-row):active{background-color:#ddd}.element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}mat-expansion-panel[_ngcontent-%COMP%]   .container-filter[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem;justify-content:flex-start;align-items:center}mat-expansion-panel[_ngcontent-%COMP%]   .item-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}mat-expansion-panel[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1 0 25%;max-width:275px;min-width:150px}mat-expansion-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .75rem 0 0}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:.5rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex-grow:1;margin:.1rem}.successLabel[_ngcontent-%COMP%]{color:green}.errorLabel[_ngcontent-%COMP%]{color:red}.infoLabel[_ngcontent-%COMP%]{color:#000}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:white}.mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:3rem}.selected[_ngcontent-%COMP%]{background-color:#0000000a}"]})}return i})();var k=s(309),Xe=s(844);const{selectEntities:Ke,selectAll:et}=Xe.v_.getSelectors(),f=(0,m.ZF)("equipmentDefinition"),tt=((0,m.P1)(f,i=>i),(0,m.P1)(f,et)),it=((0,m.P1)(f,Ke),(0,m.P1)(f,i=>i.loadingEquipmentDefinitions));(0,m.P1)(f,i=>i.errorLoadingEquipmentDefinitions),(0,m.P1)(f,i=>i.creatingEquipmentDefinition),(0,m.P1)(f,i=>i.createdEquipmentDefinition),(0,m.P1)(f,i=>i.errorCreatingEquipmentDefinition),(0,m.P1)(f,i=>i.selectedEquipmentDefinition),(0,m.P1)(f,i=>i.errorLoadingSelectedEquipmentDefinition),(0,m.P1)(f,i=>i.updatingEquipmentDefinition),(0,m.P1)(f,i=>i.updatedEquipmentDefinition),(0,m.P1)(f,i=>i.errorUpdatingEquipmentDefinition);var nt=s(4025);const ot=["errorLabel"],rt=["gradeInput"],at=["sizeInput"];function lt(i,r){if(1&i&&(e.TgZ(0,"mat-option",40),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.value),e.xp6(1),e.hij(" ",t.name," ")}}function st(i,r){if(1&i&&(e.TgZ(0,"mat-option",40),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function ct(i,r){if(1&i&&(e.TgZ(0,"mat-option",40),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(1),e.AsE(" ",t.sizeMetric,"(mm) / ",t.sizeImperial,"(in) ")}}function mt(i,r){1&i&&(e.TgZ(0,"th",41),e._uU(1,"Category"),e.qZA())}function pt(i,r){if(1&i&&(e.TgZ(0,"td",42),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",t.category,"")}}function dt(i,r){1&i&&(e.TgZ(0,"th",41),e._uU(1,"Grade"),e.qZA())}function ut(i,r){if(1&i&&(e.TgZ(0,"td",42),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",t.grade.name,"")}}function ft(i,r){1&i&&(e.TgZ(0,"th",41),e._uU(1,"Size (mm)"),e.qZA())}function gt(i,r){if(1&i&&(e.TgZ(0,"td",42),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",t.size.sizeMetric,"")}}function ht(i,r){1&i&&(e.TgZ(0,"th",41),e._uU(1,"Size (in)"),e.qZA())}function _t(i,r){if(1&i&&(e.TgZ(0,"td",42),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",t.size.sizeImperial,"")}}function Ct(i,r){1&i&&e._UZ(0,"tr",43)}function yt(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"tr",44),e.NdJ("click",function(){const a=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.selection.toggle(a))}),e.qZA()}if(2&i){const t=r.$implicit,o=e.oxw();e.ekj("selected",o.selection.isSelected(t))}}function bt(i,r){1&i&&(e.TgZ(0,"th",45),e._uU(1,"Description"),e.qZA())}function Tt(i,r){if(1&i&&(e.TgZ(0,"td",46),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",t.description,"")}}function Pt(i,r){1&i&&(e.TgZ(0,"div",47),e._UZ(1,"mat-progress-spinner",48),e.qZA())}let At=(()=>{class i{constructor(t,o,n,a){this.store=t,this.dialogRef=o,this.snackBar=n,this.equipmentDefinitionService=a,this.displayedColumns=["Category","Grade","Size Metric","Size Imperial","Description"],this.descriptionFormControl=new l.NI,this.categoryFormControl=new l.NI,this.gradeFormControl=new l.NI,this.sizeFormControl=new l.NI,this.unsubscribe$=new x.x,this.dataSource=new c.by([]),this.equipmentDefinitionsList$=this.store.select(tt),this.loadingEquipmentDefinitions=!1,this.loading$=this.store.select(it),this.equipmentSearchParams={category:null,description:null,gradeId:null,sizeId:null,isActive:!0},this.selection=new L.Ov(!1,[]),this.grades=[],this.sizes=[],this.filteredGrades=[],this.filteredSizes=[],this.categories=[{name:"Collar",value:"Collar"},{name:"Stabbing Guide",value:"StabbingGuide"},{name:"Pup Joint",value:"PupJoint"},{name:"Drift",value:"Drift"}],this.grades$=this.store.select(g.x8),this.sizes$=this.store.select(g.Ry),this.equipmentForm=new l.cw({description:this.descriptionFormControl,category:this.categoryFormControl,grade:this.gradeFormControl,size:this.sizeFormControl})}ngOnInit(){this.loading$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.loadingEquipmentDefinitions=t}),console.log("Equipment form controls:"),console.log(this.equipmentForm.controls),this.store.dispatch((0,J.Nh)()),this.loadEquipmentDefinitions(),this.subscribeToEquipmentDefinitions(),this.setupFilterSubscriptions()}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}loadEquipmentDefinitions(){console.log("Loading equipment definitions."),this.store.dispatch((0,k.Vz)({searchParams:this.equipmentSearchParams}))}subscribeToEquipmentDefinitions(){this.equipmentDefinitionsList$.subscribe(t=>{t&&(this.dataSource.data=t)})}setupFilterSubscriptions(){this.grades$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.grades=t,this.filteredGrades=t}),this.sizes$.pipe((0,d.R)(this.unsubscribe$)).subscribe(t=>{this.sizes=t,this.filteredSizes=t})}filter(){this.setSearchParametersFromForm(),console.log("Current searchParams:",this.equipmentSearchParams),this.store.dispatch((0,k.Vz)({searchParams:this.equipmentSearchParams}))}setSearchParametersFromForm(){this.equipmentSearchParams={category:this.categoryFormControl.value?this.categoryFormControl.value:null,description:this.descriptionFormControl.value?this.descriptionFormControl.value:null,gradeId:this.equipmentForm.value.grade?this.equipmentForm.value.grade.pipeProperty_GradeId:null,sizeId:this.equipmentForm.value.size?this.equipmentForm.value.size.pipeProperty_SizeId:null,isActive:!0}}clearForm(){this.equipmentForm.reset(),this.equipmentSearchParams={category:null,description:null,gradeId:null,sizeId:null,isActive:!0},this.filteredGrades=[],this.filteredSizes=[],this.store.dispatch((0,k.Vz)({searchParams:this.equipmentSearchParams}))}selectEquipmentDefinition(){if(this.selection.isEmpty())return void this.showSnackBar("Please select an equipment definition to continue.","Close",{panelClass:["error-snack-bar"]});const t=this.selection.selected[0];console.log("Selected equipment definition:",t.category),this.dialogRef.close(t)}cancel(){this.dialogRef.close()}newFromFilters(){Object.values(this.equipmentForm.value).some(o=>null===o)?this.showSnackBar("All filters must be set before creating a new equipment definition.","Close",{panelClass:["error-snack-bar"]}):this.dataSource.data.some(o=>o.category===this.equipmentSearchParams.category&&o.gradeId===this.equipmentSearchParams.gradeId&&o.sizeId===this.equipmentSearchParams.sizeId&&o.isActive===this.equipmentSearchParams.isActive)?this.showSnackBar("An equipment definition with these properties already exists.","Close",{panelClass:["error-snack-bar"]}):(this.setSearchParametersFromForm(),console.log("CHECKING FOR EXISTS ON SERVER: ",this.equipmentSearchParams),this.equipmentDefinitionService.checkEquipmentDefinitionExists(this.equipmentSearchParams).pipe((0,U.w)(o=>(console.log("Does it exists? ",o,typeof o),!1===o?this.createEquipmentDefinition(this.equipmentSearchParams):(this.showSnackBar("An equipment definition with these properties already exists on the server.","Close",{panelClass:["error-snack-bar"]}),z.E)))).subscribe({next:o=>{console.log("Equipment definition created successfully:",o),this.showSnackBar("New equipment definition created successfully!","Close",{panelClass:["confirmation-snack-bar"]}),this.loadEquipmentDefinitions()},error:o=>{this.showSnackBar("Failed to create equipment definition.","Close",{panelClass:["error-snack-bar"]}),console.error("Failed to create equipment definition:",o)}}))}createEquipmentDefinition(t){return this.equipmentDefinitionService.createEquipmentDefinition({category:t.category,gradeId:t.gradeId,sizeId:t.sizeId,isActive:!0,description:t.description,notes:""})}showSnackBar(t,o="Close",n={}){const p={duration:5e3,panelClass:["snack-bar"],...n};this.snackBar.open(t,o,p)}onGradeBlur(){const t=this.gradeInput.nativeElement.value;this.filteredGrades.some(o=>o.name.toLowerCase()===t.toLowerCase())||this.gradeFormControl.setValue("")}onSizeBlur(){const t=this.sizeInput.nativeElement.value;this.filteredSizes.find(n=>`${n.sizeMetric}(mm)/${n.sizeImperial}(in)`==t)||this.sizeFormControl.setValue("")}filterGrades(){const t=this.gradeInput.nativeElement.value.toLowerCase();this.filteredGrades=this.grades.filter(o=>o.name.toLowerCase().includes(t))}filterSizes(){const t=this.sizeInput.nativeElement.value.toLowerCase();this.filteredSizes=this.sizes.filter(o=>(o.sizeMetric.toString().toLowerCase()+"(mm)/"+o.sizeImperial.toString().toLowerCase()+"(in)").includes(t))}displaySize(t){return t?t.sizeMetric+"(mm)/"+t.sizeImperial+"(in)":""}displayGrade(t){return t?t.name:""}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(m.yh),e.Y36(w.so),e.Y36(R.ux),e.Y36(nt.l))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-equipment-definition-select"]],viewQuery:function(o,n){if(1&o&&(e.Gf(ot,5),e.Gf(rt,5),e.Gf(at,5)),2&o){let a;e.iGM(a=e.CRH())&&(n.errorLabel=a.first),e.iGM(a=e.CRH())&&(n.gradeInput=a.first),e.iGM(a=e.CRH())&&(n.sizeInput=a.first)}},decls:67,vars:12,consts:[[1,"equipment-definition-select-container"],[2,"margin-bottom",".5rem","text-align","center"],["expanded","true",1,"filter-options",2,"padding-top","1rem"],[3,"formGroup"],[1,"container-filter"],["appearance","outline","color","accent"],["matInput","","formControlName","description","placeholder","Description"],["appearance","outline","floatLabel","always"],["placeholder","Select category","formControlName","category"],["categorySelect",""],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Select grade","matInput","","formControlName","grade",3,"matAutocomplete","input","focus","blur"],["gradeInput",""],["autoActiveFirstOption","",3,"displayWith"],["autoGrade","matAutocomplete"],["type","text","placeholder","Select size","matInput","","formControlName","size",3,"matAutocomplete","input","focus","blur"],["sizeInput",""],["autoSize","matAutocomplete"],[1,"item-buttons"],["mat-raised-button","","type","button","color","primary",3,"click"],["mat-raised-button","","type","button",3,"click"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","Category"],["mat-header-cell","","mat-sort-header","","class","narrow-column",4,"matHeaderCellDef"],["mat-cell","","class","narrow-column",4,"matCellDef"],["matColumnDef","Grade"],["matColumnDef","Size Metric"],["matColumnDef","Size Imperial"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["matColumnDef","Description"],["mat-header-cell","","mat-sort-header","","class","wide-column",4,"matHeaderCellDef"],["mat-cell","","class","wide-column",4,"matCellDef"],["class","spinner",4,"ngIf"],[1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"errorLabel",2,"display","none","text-align","center","margin-top","5px"],["errorLabel",""],[3,"value"],["mat-header-cell","","mat-sort-header","",1,"narrow-column"],["mat-cell","",1,"narrow-column"],["mat-header-row",""],["mat-row","",3,"click"],["mat-header-cell","","mat-sort-header","",1,"wide-column"],["mat-cell","",1,"wide-column"],[1,"spinner"],["color","primary","mode","indeterminate"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Select Equipment Definition"),e.qZA(),e.TgZ(3,"div")(4,"mat-accordion")(5,"mat-expansion-panel",2)(6,"form",3)(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),e._uU(10,"Description"),e.qZA(),e._UZ(11,"input",6),e.qZA(),e.TgZ(12,"mat-form-field",7)(13,"mat-label"),e._uU(14,"Category"),e.qZA(),e.TgZ(15,"mat-select",8,9),e.YNc(17,lt,2,2,"mat-option",10),e.qZA()(),e.TgZ(18,"mat-form-field",7)(19,"mat-label"),e._uU(20,"Grade"),e.qZA(),e.TgZ(21,"input",11,12),e.NdJ("input",function(){return n.filterGrades()})("focus",function(){return n.filterGrades()})("blur",function(){return n.onGradeBlur()}),e.qZA(),e.TgZ(23,"mat-autocomplete",13,14),e.YNc(25,st,2,2,"mat-option",10),e.qZA()(),e.TgZ(26,"mat-form-field",7)(27,"mat-label"),e._uU(28,"Size"),e.qZA(),e.TgZ(29,"input",15,16),e.NdJ("input",function(){return n.filterSizes()})("focus",function(){return n.filterSizes()})("blur",function(){return n.onSizeBlur()}),e.qZA(),e.TgZ(31,"mat-autocomplete",13,17),e.YNc(33,ct,2,3,"mat-option",10),e.qZA()()(),e.TgZ(34,"div",18)(35,"button",19),e.NdJ("click",function(){return n.filter()}),e._uU(36,"Filter"),e.qZA(),e.TgZ(37,"button",20),e.NdJ("click",function(){return n.clearForm()}),e._uU(38,"Clear filters"),e.qZA()()()()(),e.TgZ(39,"table",21),e.ynx(40,22),e.YNc(41,mt,2,0,"th",23),e.YNc(42,pt,2,1,"td",24),e.BQk(),e.ynx(43,25),e.YNc(44,dt,2,0,"th",23),e.YNc(45,ut,2,1,"td",24),e.BQk(),e.ynx(46,26),e.YNc(47,ft,2,0,"th",23),e.YNc(48,gt,2,1,"td",24),e.BQk(),e.ynx(49,27),e.YNc(50,ht,2,0,"th",23),e.YNc(51,_t,2,1,"td",24),e.BQk(),e.YNc(52,Ct,1,0,"tr",28),e.YNc(53,yt,1,2,"tr",29),e.ynx(54,30),e.YNc(55,bt,2,0,"th",31),e.YNc(56,Tt,2,1,"td",32),e.BQk(),e.qZA(),e.YNc(57,Pt,2,0,"div",33),e.TgZ(58,"div",34)(59,"button",35),e.NdJ("click",function(){return n.selectEquipmentDefinition()}),e._uU(60,"Select Equipment Definition"),e.qZA(),e.TgZ(61,"button",36),e.NdJ("click",function(){return n.cancel()}),e._uU(62,"Cancel"),e.qZA(),e.TgZ(63,"button",37),e.NdJ("click",function(){return n.newFromFilters()}),e._uU(64,"New From Filters"),e.qZA()(),e._UZ(65,"div",38,39),e.qZA()()),2&o){const a=e.MAs(24),p=e.MAs(32);e.xp6(6),e.Q6J("formGroup",n.equipmentForm),e.xp6(11),e.Q6J("ngForOf",n.categories),e.xp6(4),e.Q6J("matAutocomplete",a),e.xp6(2),e.Q6J("displayWith",n.displayGrade),e.xp6(2),e.Q6J("ngForOf",n.filteredGrades),e.xp6(4),e.Q6J("matAutocomplete",p),e.xp6(2),e.Q6J("displayWith",n.displaySize),e.xp6(2),e.Q6J("ngForOf",n.filteredSizes),e.xp6(6),e.Q6J("dataSource",n.dataSource),e.xp6(13),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(4),e.Q6J("ngIf",n.loadingEquipmentDefinitions)}},dependencies:[y.sg,y.O5,D.Ou,_.KE,_.hX,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,P.lW,v.Nt,S.gD,A.ey,C.pp,C.ib,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,I.XC,I.ZL],styles:["mat-card[_ngcontent-%COMP%]{min-width:500px;width:100%;overflow-x:auto}h4[_ngcontent-%COMP%]{margin-top:20;margin-bottom:.4rem}.title-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;font-weight:700;font-size:1.5rem}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:1rem;border:solid pink 3px}.container-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;width:100%}.data-column-left[_ngcontent-%COMP%], .data-column-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.data-column-right[_ngcontent-%COMP%]{padding:1px;margin:0;align-items:flex-end}tr.detail-row[_ngcontent-%COMP%]{height:0}tr.element-row[_ngcontent-%COMP%]:not(.expanded-row):hover{background-color:#f5f5f5}tr.element-row[_ngcontent-%COMP%]:not(.expanded-row):active{background-color:#ddd}.element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}mat-expansion-panel[_ngcontent-%COMP%]   .container-filter[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem;justify-content:flex-start;align-items:center}mat-expansion-panel[_ngcontent-%COMP%]   .item-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}mat-expansion-panel[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1 0 25%;max-width:275px;min-width:150px}mat-expansion-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .75rem 0 0}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:.5rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex-grow:1;margin:.1rem}.successLabel[_ngcontent-%COMP%]{color:green}.errorLabel[_ngcontent-%COMP%]{color:red}.infoLabel[_ngcontent-%COMP%]{color:#000}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:white}.mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:3rem}.selected[_ngcontent-%COMP%]{background-color:#0000000a}.narrow-column[_ngcontent-%COMP%]{width:12.5%}.wide-column[_ngcontent-%COMP%]{width:50%}"]})}return i})();var vt=s(5124);const wt=["lengthInMetersInput"];function Zt(i,r){if(1&i&&(e.TgZ(0,"mat-option",56),e._uU(1),e.qZA()),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("value",t),e.xp6(1),e.hij(" ",o.displayTallyType(t)," ")}}function It(i,r){if(1&i&&(e.TgZ(0,"mat-option",56),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.shopLocationId),e.xp6(1),e.hij(" ",t.name," ")}}function Dt(i,r){if(1&i&&(e.TgZ(0,"mat-option",56),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.customerId),e.xp6(1),e.hij(" ",t.name," ")}}function St(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Please Select a Pipe Definition "),e.qZA())}function qt(i,r){if(1&i&&(e.TgZ(0,"mat-option",56),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.rackId),e.xp6(1),e.hij(" ",t.name," ")}}function xt(i,r){if(1&i&&(e.TgZ(0,"mat-option",56),e._uU(1),e.qZA()),2&i){const t=r.$implicit,o=e.oxw();e.Q6J("value",t.tierId),e.xp6(1),e.hij(" ",o.tierDisplay(t)," ")}}function Mt(i,r){1&i&&(e.TgZ(0,"button",57),e._uU(1,"Add Pipe"),e.qZA())}function Ft(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",58),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.updatePipe())}),e._uU(1,"Update Pipe"),e.qZA()}}function kt(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",59),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancelEdit())}),e._uU(1,"Cancel"),e.qZA()}}function Nt(i,r){1&i&&(e.TgZ(0,"th",60),e._uU(1,"Quantity"),e.qZA())}function Et(i,r){if(1&i&&(e.TgZ(0,"td",61),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",t.quantity," ")}}function Ot(i,r){1&i&&(e.TgZ(0,"th",60),e._uU(1,"Length (m)"),e.qZA())}function zt(i,r){if(1&i&&(e.TgZ(0,"td",61),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.hij(" ",t.lengthInMeters," ")}}function Ut(i,r){1&i&&(e.TgZ(0,"th",60),e._uU(1,"Pipe Properties"),e.qZA())}function Jt(i,r){if(1&i&&(e.TgZ(0,"td",61),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.xp6(1),e.xDo(" ",null==t.pipeDefinition.category?null:t.pipeDefinition.category.name," - ",t.pipeDefinition.size.sizeMetric,"mm - ",t.pipeDefinition.condition.name," - ",t.pipeDefinition.grade.name," - ",t.pipeDefinition.wall.wallMetric,"mm ")}}function Lt(i,r){1&i&&e._UZ(0,"th",62)}function Rt(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"td",63)(1,"button",64),e.NdJ("click",function(){const a=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.editPipe(a))}),e._UZ(2,"mat-icon",65),e.qZA(),e.TgZ(3,"button",66),e.NdJ("click",function(){const a=e.CHM(t).$implicit,p=e.oxw();return e.KtG(p.removePipe(a))}),e._UZ(4,"mat-icon",67),e.qZA()()}}function Qt(i,r){1&i&&e._UZ(0,"tr",68)}function $t(i,r){1&i&&e._UZ(0,"tr",69)}function Bt(i,r){1&i&&(e.TgZ(0,"div",70),e._uU(1," No pipe have been added yet "),e.qZA())}function Gt(i,r){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Please Select an Equipment Definition "),e.qZA())}function Yt(i,r){1&i&&(e.TgZ(0,"button",57),e._uU(1,"Add Equipment"),e.qZA())}function Wt(i,r){1&i&&(e.TgZ(0,"button",71),e._uU(1,"Update Equipment"),e.qZA())}function jt(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",59),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancelEdit())}),e._uU(1,"Cancel"),e.qZA()}}let Vt=(()=>{class i{constructor(t,o,n,a){this.store=t,this.router=o,this.notificationService=n,this.dialog=a,this.isInit=!0,this.loading=!0,this.error=null,this.showPipeDefinitionSelectedError=!1,this.showEquipmentDefinitionSelectedError=!1,this.shops=[],this.customers=[],this.tallyTypes=Object.values(Z.t).filter(p=>"number"==typeof p),this.racksWithTiers=[],this.customersFullList=[],this.pipeDefinitionList=[],this.shopLocations=[],this.tiers=[],this.emptyGuid="00000000-0000-0000-0000-000000000000",this.selectedPipe=null,this.selectedEquipment=null,this.selectedPipeDefinition=null,this.displayedColumns=["quantity","lengthInMeters","pipeProperties","actions"],this.dataSourcePipe=new c.by,this.dataSourceEquipment=new c.by,this.registeredPipes=[],this.registeredEquipment=[],this.destroy$=new x.x,this.racksWithTiers$=this.store.select(j.A2),this.customersFullList$=this.store.select(V.JZ),this.shopLocationList$=this.store.select(X.ST),this.creatingTally$=this.store.select(M.yY),this.createdTally$=this.store.select(M.NT),this.error$=this.store.select(M.vS)}ngOnInit(){this.store.dispatch((0,W.cR)({searchParams:null})),this.store.dispatch((0,O.z8)()),this.store.dispatch((0,O.NW)()),this.buildForm(),this.dataSourcePipe=new c.by(this.registeredPipes),this.dataSourceEquipment=new c.by(this.registeredEquipment),this.racksWithTiers$.pipe((0,d.R)(this.destroy$)).subscribe(t=>{t&&(this.racksWithTiers=t)}),this.customersFullList$.pipe((0,d.R)(this.destroy$)).subscribe(t=>{t&&(this.customersFullList=t)}),this.shopLocationList$.pipe((0,d.R)(this.destroy$)).subscribe(t=>{t&&(this.shopLocations=t)}),this.error$.subscribe(t=>{t&&(console.error(t),this.error=t,this.notificationService.success("There was a problem creating the tally. "))}),this.createdTally$.subscribe(t=>{console.log("tally: ",t),t&&!this.isInit&&(this.notificationService.success("Tally created successfully"),this.close())}),this.creatingTally$.subscribe(t=>{this.loading=t})}buildForm(){this.tallyAddForm=new l.cw({tallyType:new l.NI(Z.t.TallyIn,[l.kI.required]),tallyNumber:new l.NI(null,[l.kI.required]),customer:new l.NI(null,[l.kI.required]),shopLocation:new l.NI(null,[l.kI.required]),dateOfCreation:new l.NI(new Date,[l.kI.required]),notes:new l.NI(null),invoiceNumber:new l.NI(null),carrierName:new l.NI(null,[l.kI.required])}),this.pipeAddForm=new l.cw({rack:new l.NI(null,[l.kI.required]),tier:new l.NI(null,[l.kI.required]),pipeDefinition:new l.NI(null,[l.kI.required]),equipmentDefinition:new l.NI(null),lengthInMeters:new l.NI(null,[l.kI.required]),quantity:new l.NI(null,[l.kI.required])}),this.equipmentAddForm=new l.cw({equipmentDefinition:new l.NI(null,[l.kI.required]),quantityEquipment:new l.NI(null,[l.kI.required]),lengthInMetersEquipment:new l.NI(null,[l.kI.required])})}createTally(){if(this.tallyAddForm.invalid)return void this.tallyAddForm.markAllAsTouched();const t=[];this.registeredPipes.forEach(n=>{n.lengthInFeet=3.280839895*n.lengthInMeters,n.customerId=this.tallyAddForm.get("customer")?.value;const a=t.find(p=>p.tierId===n.tierId);a?a.pipeList.push(n):t.push({tierId:n.tierId,pipeList:[n]})});const o={tallyNumber:this.tallyAddForm.get("tallyNumber")?.value,shopLocationId:this.tallyAddForm.get("shopLocation")?.value,tallyType:this.tallyAddForm.get("tallyType")?.value,dateOfCreation:new Date(this.tallyAddForm.get("dateOfCreation")?.value).toISOString(),notes:this.tallyAddForm.get("notes")?.value,invoiceNumber:this.tallyAddForm.get("invoiceNumber")?.value,carrierName:this.tallyAddForm.get("carrierName")?.value,tierList:t,customerId:this.tallyAddForm.get("customer")?.value,talliedByUserId:"B3CFC44C-879B-43EF-B6F0-02FA0D232430"};this.isInit=!1,this.store.dispatch((0,H.BQ)({tallyCreate:o}))}addPipe(t){if(!this.selectedPipe)if(this.pipeDefinitionList.find(o=>o.pipeDefinitionId===this.pipeAddForm.get("pipeDefinition")?.value),this.pipeAddForm.invalid)this.pipeAddForm.markAllAsTouched();else{const o={pipeDefinitionId:this.pipeAddForm.get("pipeDefinition")?.value,tierId:this.pipeAddForm.get("tier")?.value,rackId:this.pipeAddForm.get("rack")?.value,customerId:this.tallyAddForm.get("customer")?.value,lengthInMeters:this.pipeAddForm.get("lengthInMeters")?.value,lengthInFeet:this.pipeAddForm.get("lengthInFeet")?.value,quantity:this.pipeAddForm.get("quantity")?.value,indexOfPipe:1,pipeDefinition:this.selectedPipeDefinition};this.registeredPipes.push(o),this.dataSourcePipe.data=this.registeredPipes,this.clearAfterPipeAdd(),this.formDirective=t}}addEquipment(t){if(!this.selectedPipe)if(this.pipeAddForm.invalid)this.pipeAddForm.markAllAsTouched();else{const o={pipeDefinitionId:this.pipeAddForm.get("pipeDefinition")?.value,tierId:this.pipeAddForm.get("tier")?.value,rackId:this.pipeAddForm.get("rack")?.value,customerId:this.tallyAddForm.get("customer")?.value,lengthInMeters:this.pipeAddForm.get("lengthInMeters")?.value,lengthInFeet:this.pipeAddForm.get("lengthInFeet")?.value,quantity:this.pipeAddForm.get("quantity")?.value,indexOfPipe:1,pipeDefinition:this.pipeDefinitionList.find(n=>n.pipeDefinitionId===this.pipeAddForm.get("pipeDefinition")?.value)};this.registeredPipes.push(o),this.dataSourcePipe.data=this.registeredPipes,this.clearAfterPipeAdd(),this.formDirective=t}}clearAfterPipeAdd(){this.pipeAddForm.reset({lengthInMeters:null,rack:null,tier:null,pipeDefinition:null,quantity:null}),this.selectedPipeDefinition=null,this.pipeAddForm.markAsPristine(),this.pipeAddForm.markAsUntouched(),Object.keys(this.pipeAddForm.controls).forEach(t=>{const o=this.pipeAddForm.get(t);o?.setErrors(null),o?.markAsPristine(),o?.markAsUntouched(),o?.updateValueAndValidity()}),this.pipeAddForm.updateValueAndValidity()}editPipe(t){this.pipeAddForm.patchValue({rack:t.rackId,tier:t.tierId,pipeDefinition:t.pipeDefinitionId,lengthInMeters:t.lengthInMeters,quantity:t.quantity}),this.selectedPipe=t}updatePipe(){const t={pipeDefinitionId:this.pipeAddForm.get("pipeDefinition")?.value,tierId:this.pipeAddForm.get("tier")?.value,rackId:this.pipeAddForm.get("rack")?.value,customerId:this.tallyAddForm.get("customer")?.value,lengthInMeters:this.pipeAddForm.get("lengthInMeters")?.value,lengthInFeet:this.pipeAddForm.get("lengthInFeet")?.value,quantity:this.pipeAddForm.get("quantity")?.value,indexOfPipe:1,pipeDefinition:this.pipeDefinitionList.find(n=>n.pipeDefinitionId===this.pipeAddForm.get("pipeDefinition")?.value)},o=this.registeredPipes.indexOf(this.selectedPipe);this.registeredPipes[o]=t,this.dataSourcePipe.data=this.registeredPipes,this.selectedPipe=null,this.pipeAddForm.reset(),this.formDirective.resetForm()}cancelEdit(){this.selectedPipe=null,this.pipeAddForm.reset(),this.formDirective.resetForm()}removePipe(t){this.registeredPipes=this.registeredPipes.filter(o=>o!==t),this.dataSourcePipe.data=this.registeredPipes}onRackChange(t){this.tiers=[{tierId:this.emptyGuid,rackId:t.value,number:0,pipeCount:0},...this.racksWithTiers.find(n=>n.rackId===t.value)?.tierList]}tierDisplay(t){return t.tierId===this.emptyGuid?"New Tier":t.number}close(){this.router.navigate(["/dashboard"])}displayTallyType(t){return t===Z.t.TallyIn?"In":t===Z.t.TallyOut?"Out":""}preventDecimal(t){("."===t.key||"-"===t.key)&&t.preventDefault()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}openSelectPipeDefinitionDialog(){this.dialog.open(He,{width:"90%",maxWidth:"none",maxHeight:"none",height:"90%",panelClass:"custom-dialog-container",autoFocus:!1}).afterClosed().subscribe(o=>{if(o){var n="";n+="Category: "+o.category?.name,n+="- Condition: "+o.condition?.name,n+="- Grade: "+o.grade?.name,n+="- Size: "+o.size?.sizeMetric+"(mm)/"+o.size?.sizeImperial+"(in)",this.pipeAddForm.get("pipeDefinition").setValue(n),this.selectedPipeDefinition=o}console.log("The dialog was closed")})}openSelectEquipmentDefinitionDialog(){this.dialog.open(At,{width:"90%",maxWidth:"none",maxHeight:"none",height:"90%",panelClass:"custom-dialog-container",autoFocus:!1}).afterClosed().subscribe(o=>{if(o){var n="";n+="Category: "+o.category,n+=" - Grade: "+o.grade.name,n+=" - Size: "+o.size.sizeMetric+"(mm)/"+o.size.sizeImperial+"(in)",n+=" - Description: "+(o.description||"N/A"),this.equipmentAddForm.get("equipmentDefinition").setValue(n),console.log("We have a selection: "+n)}else console.log("WE DO NOT HAVE A SELECTION.");console.log("The dialog was closed")})}static#e=this.\u0275fac=function(o){return new(o||i)(e.Y36(m.yh),e.Y36(q.F0),e.Y36(vt.g),e.Y36(w.uw))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-tally-add"]],viewQuery:function(o,n){if(1&o&&e.Gf(wt,5),2&o){let a;e.iGM(a=e.CRH())&&(n.lengthInMetersInput=a.first)}},decls:161,vars:22,consts:[[1,"tally-card"],[1,"close-icon",3,"click"],["multi","true"],["expanded","",2,"margin-bottom","1rem"],[1,"container-horizontal"],[3,"formGroup","ngSubmit"],["formDirective","ngForm"],["appearance","outline","color","accent"],["formControlName","tallyType","required",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","placeholder","Tally name","formControlName","tallyNumber","required",""],["matInput","","placeholder","Invoice number","formControlName","invoiceNumber","required",""],["formControlName","shopLocation","required",""],["formControlName","customer","required",""],["matInput","","formControlName","dateOfCreation",3,"matDatepicker"],["matIconSuffix","",3,"for"],["datepicker",""],["mat-button","","matDatepickerCancel",""],["mat-raised-button","","color","primary","matDatepickerApply",""],["matInput","","placeholder","Consultant name","formControlName","carrierName","required",""],[1,"full-width"],["matInput","","placeholder","Enter notes","formControlName","notes"],[2,"margin-bottom","1rem"],[1,"full-width",2,"margin-bottom","15px"],["appearance","outline","color","accent",2,"margin-bottom","-1rem"],["type","text","matInput","","placeholder","Select Pipe Definition","formControlName","pipeDefinition","readonly","","required","",3,"click"],[4,"ngIf"],["type","button","mat-raised-button","","color","primary",3,"click"],["formControlName","rack","required","",3,"selectionChange"],["formControlName","tier","required",""],["type","number","matInput","","placeholder","Quantity","formControlName","quantity","required",""],["type","number","matInput","","placeholder","Length in meters","formControlName","lengthInMeters","required",""],[1,"actions"],["mat-raised-button","","color","primary","type","submit",4,"ngIf"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","",3,"click",4,"ngIf"],["mat-table","",3,"dataSource"],["matColumnDef","quantity"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","lengthInMeters"],["matColumnDef","pipeProperties"],["matColumnDef","actions"],["mat-header-cell","","mat-sort-header","","class","right-align",4,"matHeaderCellDef"],["mat-cell","","class","column-actions right-align",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","display-message",4,"ngIf"],["equipmentFormDirective","ngForm"],[1,"three-col"],["type","text","matInput","","placeholder","Select Equipment Definition","formControlName","equipmentDefinition","readonly","","required","",3,"click"],["type","number","matInput","","placeholder","Quantity","formControlName","quantityEquipment","required",""],["type","number","matInput","","placeholder","Length in meters","formControlName","lengthInMetersEquipment","required",""],["mat-raised-button","","color","primary",4,"ngIf"],["mat-raised-button","","color","primary",1,"item",3,"click"],["mat-raised-button","",1,"item",3,"click"],[3,"value"],["mat-raised-button","","color","primary","type","submit"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","","mat-sort-header","",1,"right-align"],["mat-cell","",1,"column-actions","right-align"],["mat-icon-button","","aria-label","Edit pipe",3,"click"],["aria-hidden","false","fontIcon","edit","color","accent"],["mat-icon-button","","aria-label","Remove pipe",3,"click"],["aria-hidden","false","fontIcon","delete","color","accent"],["mat-header-row",""],["mat-row",""],[1,"display-message"],["mat-raised-button","","color","primary"]],template:function(o,n){if(1&o){const a=e.EpF();e.TgZ(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),e._uU(3,"Add Tally"),e.qZA(),e.TgZ(4,"mat-icon",1),e.NdJ("click",function(){return n.close()}),e._uU(5,"close"),e.qZA()(),e.TgZ(6,"mat-card-content")(7,"mat-accordion",2)(8,"mat-expansion-panel",3)(9,"mat-expansion-panel-header")(10,"mat-panel-title"),e._uU(11,"General Info"),e.qZA()(),e.TgZ(12,"div",4)(13,"form",5,6),e.NdJ("ngSubmit",function(){e.CHM(a);const h=e.MAs(14);return e.KtG(n.addPipe(h))}),e.TgZ(15,"mat-form-field",7)(16,"mat-label"),e._uU(17,"Tally Type"),e.qZA(),e.TgZ(18,"mat-select",8),e.YNc(19,Zt,2,2,"mat-option",9),e.qZA()(),e.TgZ(20,"mat-form-field",7)(21,"mat-label"),e._uU(22,"Tally Number"),e.qZA(),e._UZ(23,"input",10),e.TgZ(24,"mat-error"),e._uU(25," Please provide a tally name "),e.qZA()(),e.TgZ(26,"mat-form-field",7)(27,"mat-label"),e._uU(28,"Invoice Number"),e.qZA(),e._UZ(29,"input",11),e.TgZ(30,"mat-error"),e._uU(31," Please provide an invoice number "),e.qZA()(),e.TgZ(32,"mat-form-field",7)(33,"mat-label"),e._uU(34,"Yard"),e.qZA(),e.TgZ(35,"mat-select",12),e.YNc(36,It,2,2,"mat-option",9),e.qZA()(),e.TgZ(37,"mat-form-field",7)(38,"mat-label"),e._uU(39,"Customer"),e.qZA(),e.TgZ(40,"mat-select",13),e.YNc(41,Dt,2,2,"mat-option",9),e.qZA()(),e.TgZ(42,"mat-form-field")(43,"mat-label"),e._uU(44,"Date"),e.qZA(),e._UZ(45,"input",14)(46,"mat-datepicker-toggle",15),e.TgZ(47,"mat-datepicker",null,16)(49,"mat-datepicker-actions")(50,"button",17),e._uU(51,"Cancel"),e.qZA(),e.TgZ(52,"button",18),e._uU(53,"Ok"),e.qZA()()()(),e.TgZ(54,"mat-form-field",7)(55,"mat-label"),e._uU(56,"Consultant Name"),e.qZA(),e._UZ(57,"input",19),e.TgZ(58,"mat-error"),e._uU(59," Please provide a consultant name "),e.qZA()(),e.TgZ(60,"mat-form-field",20)(61,"mat-label"),e._uU(62,"Notes"),e.qZA(),e._UZ(63,"textarea",21),e.qZA()()()(),e.TgZ(64,"mat-expansion-panel",22)(65,"mat-expansion-panel-header")(66,"mat-panel-title"),e._uU(67,"Pipe Details"),e.qZA()(),e.TgZ(68,"div",4)(69,"form",5,6),e.NdJ("ngSubmit",function(){e.CHM(a);const h=e.MAs(14);return e.KtG(n.addPipe(h))}),e.TgZ(71,"div",23)(72,"mat-form-field",24)(73,"mat-label"),e._uU(74,"Pipe Definition"),e.qZA(),e.TgZ(75,"input",25),e.NdJ("click",function(){return n.openSelectPipeDefinitionDialog()}),e.qZA(),e.YNc(76,St,2,0,"mat-error",26),e.qZA(),e.TgZ(77,"button",27),e.NdJ("click",function(){return n.openSelectPipeDefinitionDialog()}),e.TgZ(78,"mat-icon"),e._uU(79,"add"),e.qZA(),e._uU(80," Select Pipe Definition "),e.qZA()(),e.TgZ(81,"mat-form-field",7)(82,"mat-label"),e._uU(83,"Rack"),e.qZA(),e.TgZ(84,"mat-select",28),e.NdJ("selectionChange",function(h){return n.onRackChange(h)}),e.YNc(85,qt,2,2,"mat-option",9),e.qZA()(),e.TgZ(86,"mat-form-field",7)(87,"mat-label"),e._uU(88,"Tier"),e.qZA(),e.TgZ(89,"mat-select",29),e.YNc(90,xt,2,2,"mat-option",9),e.qZA()(),e.TgZ(91,"mat-form-field",7)(92,"mat-label"),e._uU(93,"Quantity"),e.qZA(),e._UZ(94,"input",30),e.TgZ(95,"mat-error"),e._uU(96,"Please provide a value for quantity"),e.qZA()(),e.TgZ(97,"mat-form-field",7)(98,"mat-label"),e._uU(99,"Length in meters"),e.qZA(),e._UZ(100,"input",31),e.TgZ(101,"mat-error"),e._uU(102,"Please provide a value for length in meters"),e.qZA()(),e.TgZ(103,"div",32),e.YNc(104,Mt,2,0,"button",33),e.YNc(105,Ft,2,0,"button",34),e.YNc(106,kt,2,0,"button",35),e.qZA()()(),e.TgZ(107,"div")(108,"table",36),e.ynx(109,37),e.YNc(110,Nt,2,0,"th",38),e.YNc(111,Et,2,1,"td",39),e.BQk(),e.ynx(112,40),e.YNc(113,Ot,2,0,"th",38),e.YNc(114,zt,2,1,"td",39),e.BQk(),e.ynx(115,41),e.YNc(116,Ut,2,0,"th",38),e.YNc(117,Jt,2,5,"td",39),e.BQk(),e.ynx(118,42),e.YNc(119,Lt,1,0,"th",43),e.YNc(120,Rt,5,0,"td",44),e.BQk(),e.YNc(121,Qt,1,0,"tr",45),e.YNc(122,$t,1,0,"tr",46),e.qZA(),e.YNc(123,Bt,2,0,"div",47),e.qZA()(),e.TgZ(124,"mat-expansion-panel",22)(125,"mat-expansion-panel-header")(126,"mat-panel-title"),e._uU(127,"Equipment Details"),e.qZA()(),e.TgZ(128,"div",4)(129,"form",5,48),e.NdJ("ngSubmit",function(){e.CHM(a);const h=e.MAs(14);return e.KtG(n.addEquipment(h))}),e.TgZ(131,"div",49)(132,"mat-form-field",24)(133,"mat-label"),e._uU(134,"Equipment Definition"),e.qZA(),e.TgZ(135,"input",50),e.NdJ("click",function(){return n.openSelectEquipmentDefinitionDialog()}),e.qZA(),e.YNc(136,Gt,2,0,"mat-error",26),e.qZA(),e.TgZ(137,"button",27),e.NdJ("click",function(){return n.openSelectEquipmentDefinitionDialog()}),e.TgZ(138,"mat-icon"),e._uU(139,"add"),e.qZA(),e._uU(140," Select Equipment Definition "),e.qZA()(),e.TgZ(141,"mat-form-field",7)(142,"mat-label"),e._uU(143,"Quantity"),e.qZA(),e._UZ(144,"input",51),e.TgZ(145,"mat-error"),e._uU(146,"Please provide a value for quantity"),e.qZA()(),e.TgZ(147,"mat-form-field",7)(148,"mat-label"),e._uU(149,"Length in meters"),e.qZA(),e._UZ(150,"input",52),e.TgZ(151,"mat-error"),e._uU(152,"Please provide a value for length in meters"),e.qZA()(),e.TgZ(153,"div",32),e.YNc(154,Yt,2,0,"button",33),e.YNc(155,Wt,2,0,"button",53),e.YNc(156,jt,2,0,"button",35),e.qZA()()()()(),e.TgZ(157,"button",54),e.NdJ("click",function(){return n.createTally()}),e._uU(158,"Create Tally"),e.qZA(),e.TgZ(159,"button",55),e.NdJ("click",function(){return n.close()}),e._uU(160,"Cancel"),e.qZA()()()}if(2&o){const a=e.MAs(48);e.xp6(13),e.Q6J("formGroup",n.tallyAddForm),e.xp6(6),e.Q6J("ngForOf",n.tallyTypes),e.xp6(17),e.Q6J("ngForOf",n.shopLocations),e.xp6(5),e.Q6J("ngForOf",n.customersFullList),e.xp6(4),e.Q6J("matDatepicker",a),e.xp6(1),e.Q6J("for",a),e.xp6(23),e.Q6J("formGroup",n.pipeAddForm),e.xp6(7),e.Q6J("ngIf",n.showPipeDefinitionSelectedError),e.xp6(9),e.Q6J("ngForOf",n.racksWithTiers),e.xp6(5),e.Q6J("ngForOf",n.tiers),e.xp6(14),e.Q6J("ngIf",!n.selectedPipe),e.xp6(1),e.Q6J("ngIf",n.selectedPipe),e.xp6(1),e.Q6J("ngIf",n.selectedPipe),e.xp6(2),e.Q6J("dataSource",n.dataSourcePipe),e.xp6(13),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("ngIf",0===n.registeredPipes.length),e.xp6(6),e.Q6J("formGroup",n.equipmentAddForm),e.xp6(7),e.Q6J("ngIf",n.showEquipmentDefinitionSelectedError),e.xp6(18),e.Q6J("ngIf",!n.selectedEquipment),e.xp6(1),e.Q6J("ngIf",n.selectedEquipment),e.xp6(1),e.Q6J("ngIf",n.selectedEquipment)}},dependencies:[y.sg,y.O5,_.KE,_.hX,_.TO,_.R9,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk,T.a8,T.dn,T.dk,T.n5,E.Hw,P.lW,P.RK,v.Nt,S.gD,A.ey,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.sg,l.u,C.pp,C.ib,C.yz,C.yK,b.Mq,b.hl,b.nW,b.M5,b.dp,b.DK],styles:["mat-card[_ngcontent-%COMP%]{min-width:500px;width:100%;overflow-x:auto}h4[_ngcontent-%COMP%]{margin-top:20;margin-bottom:.4rem}.title-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;font-weight:700;font-size:1.5rem}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:1rem;border:solid pink 3px}.container-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;width:100%}.data-column-left[_ngcontent-%COMP%], .data-column-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.data-column-right[_ngcontent-%COMP%]{padding:1px;margin:0;align-items:flex-end}tr.detail-row[_ngcontent-%COMP%]{height:0}tr.element-row[_ngcontent-%COMP%]:not(.expanded-row):hover{background-color:#f5f5f5}tr.element-row[_ngcontent-%COMP%]:not(.expanded-row):active{background-color:#ddd}.element-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom-width:0}mat-expansion-panel[_ngcontent-%COMP%]   .container-filter[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1rem;justify-content:flex-start;align-items:center}mat-expansion-panel[_ngcontent-%COMP%]   .item-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}mat-expansion-panel[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1 0 25%;max-width:275px;min-width:150px}mat-expansion-panel[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .75rem 0 0}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:.5rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex-grow:1;margin:.1rem}.successLabel[_ngcontent-%COMP%]{color:green}.errorLabel[_ngcontent-%COMP%]{color:red}.infoLabel[_ngcontent-%COMP%]{color:#000}.spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:white}.mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:3rem}.selected[_ngcontent-%COMP%]{background-color:#0000000a}.container-horizontal[_ngcontent-%COMP%]{display:block;flex-direction:row;flex-wrap:wrap;flex:1 1 auto;margin-right:1rem}.container-horizontal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));column-gap:1rem}.container-horizontal[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;padding:0;max-width:100%}.container-horizontal[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{grid-column:1/-1;max-width:100%}.container-horizontal[_ngcontent-%COMP%]   .three-col[_ngcontent-%COMP%]{max-width:100%;grid-column:1/4}.custom-dialog-container[_ngcontent-%COMP%]{background-color:green}.actions[_ngcontent-%COMP%]{grid-column:1/-1;margin-top:1rem;max-width:1fr;min-width:250px}mat-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:1rem}mat-card-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.5rem}mat-form-field[_ngcontent-%COMP%]{display:block}h1[_ngcontent-%COMP%]{font-weight:700;font-size:1.5rem}.close-icon[_ngcontent-%COMP%]{margin-left:auto;cursor:pointer}button[_ngcontent-%COMP%]{margin-right:1rem}.right-align[_ngcontent-%COMP%]{text-align:right}.display-message[_ngcontent-%COMP%]{margin-top:1rem;text-align:center}.scrollable-table[_ngcontent-%COMP%]{height:300px;overflow-y:auto}"]})}return i})();const Xt=[{path:"",component:s(1471).j},{path:"add",component:Vt}];let Kt=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[q.Bz.forChild(Xt),q.Bz]})}return i})(),ei=(()=>{class i{static#e=this.\u0275fac=function(o){return new(o||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[y.ez,Kt,D.Cq,_.lN,c.p0,Q.TU,T.QW,E.Ps,P.ot,v.c,S.LD,$.AV,l.UX,w.Is,C.To,b.FA,A.XK,B.ie,Y]})}return i})()}}]);